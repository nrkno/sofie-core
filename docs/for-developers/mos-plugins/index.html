<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-for-developers/mos-plugins" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.1">
<title data-rh="true">MOS-plugins | Sofie TV Automation Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://nrkno.github.io/sofie-core/img/pilot_fredag-05.jpg"><meta data-rh="true" name="twitter:image" content="https://nrkno.github.io/sofie-core/img/pilot_fredag-05.jpg"><meta data-rh="true" property="og:url" content="https://nrkno.github.io/sofie-core/docs/for-developers/mos-plugins"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="MOS-plugins | Sofie TV Automation Documentation"><meta data-rh="true" name="description" content="The usage of MOS-plugins allow micro frontends to be injected into Sofie for the purpuse of adding content to the production without turning away from the Sofie UI."><meta data-rh="true" property="og:description" content="The usage of MOS-plugins allow micro frontends to be injected into Sofie for the purpuse of adding content to the production without turning away from the Sofie UI."><link data-rh="true" rel="icon" href="/sofie-core/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://nrkno.github.io/sofie-core/docs/for-developers/mos-plugins"><link data-rh="true" rel="alternate" href="https://nrkno.github.io/sofie-core/docs/for-developers/mos-plugins" hreflang="en"><link data-rh="true" rel="alternate" href="https://nrkno.github.io/sofie-core/docs/for-developers/mos-plugins" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://0J21XARTCE-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Sofie TV Automation Documentation" href="/sofie-core/opensearch.xml"><link rel="stylesheet" href="/sofie-core/assets/css/styles.6fc8b6c1.css">
<script src="/sofie-core/assets/js/runtime~main.437b8cfc.js" defer="defer"></script>
<script src="/sofie-core/assets/js/main.3120fb5a.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_oPtH" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/sofie-core/"><div class="navbar__logo"><img src="/sofie-core/img/sofie-logo.svg" alt="Sofie Logo" class="themedComponent_siVc themedComponent--light_hHel"><img src="/sofie-core/img/sofie-logo.svg" alt="Sofie Logo" class="themedComponent_siVc themedComponent--dark_yETr"></div><b class="navbar__title text--truncate">Sofie TV Automation</b></a><a class="navbar__item navbar__link" href="/sofie-core/docs/user-guide/intro">User Guide</a><a class="navbar__item navbar__link" href="/sofie-core/docs/for-developers/intro">For Developers</a><a class="navbar__item navbar__link" href="/sofie-core/releases">Releases</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/sofie-core/docs/user-guide/intro">Latest</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/sofie-core/docs/for-developers/mos-plugins">Latest</a></li><li><a class="dropdown__link" href="/sofie-core/docs/1.49.0/user-guide/intro">1.49.0</a></li><li><a class="dropdown__link" href="/sofie-core/docs/1.47.0/user-guide/intro">1.47.0</a></li><li><a class="dropdown__link" href="/sofie-core/docs/1.46.0/user-guide/intro">1.46.0</a></li><li><a class="dropdown__link" href="/sofie-core/docs/1.41.0/user-guide/intro">1.41.0</a></li><li><a class="dropdown__link" href="/sofie-core/docs/1.38.0/user-guide/intro">1.38.0</a></li><li><a class="dropdown__link" href="/sofie-core/docs/1.37.0/user-guide/intro">1.37.0</a></li></ul></div><a href="https://github.com/nrkno/sofie-core" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_ki11 colorModeToggle_Hewu"><button class="clean-btn toggleButton_MMFG toggleButtonDisabled_Uw7m" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_lgto"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_U96C"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_bzqh"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_MB5r"><div class="docsWrapper__sE8"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_iEvu" type="button"></button><div class="docRoot_DfVB"><aside class="theme-doc-sidebar-container docSidebarContainer_c7NB"><div class="sidebarViewport_KYo0"><div class="sidebar_CUen"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_jmj1"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/sofie-core/docs/for-developers/intro">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/sofie-core/docs/for-developers/contribution-guidelines">Contribution Guidelines</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/sofie-core/docs/for-developers/for-blueprint-developers/intro">For Blueprint Developers</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/sofie-core/docs/for-developers/device-integrations/intro">Device Integrations</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/sofie-core/docs/for-developers/libraries">Applications &amp; Libraries</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/sofie-core/docs/for-developers/api-documentation">API Documentation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/sofie-core/docs/for-developers/json-config-schema">JSON Config Schema</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/sofie-core/docs/for-developers/data-model">Data Model</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/sofie-core/docs/for-developers/worker-threads-and-locks">Worker Threads &amp; Locks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/sofie-core/docs/for-developers/api-stability">API Stability</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/sofie-core/docs/for-developers/publications">Publications</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/sofie-core/docs/for-developers/mos-plugins">MOS-plugins</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_oTwn"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_pMEX"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_a9sJ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_Qr34"><div class="docItemContainer_tjFy"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_T5ub" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/sofie-core/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_sfvy"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">MOS-plugins</span><meta itemprop="position" content="1"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: Latest</span><div class="tocCollapsible_wXna theme-doc-toc-mobile tocMobile_Ojys"><button type="button" class="clean-btn tocCollapsibleButton_iI2p">On this page</button></div><div class="theme-doc-markdown markdown"><h1>iFrames MOS-plugins</h1>
<p><strong>The usage of MOS-plugins allow micro frontends to be injected into Sofie for the purpuse of adding content to the production without turning away from the Sofie UI.</strong></p>
<p>Example use cases can be browsing and playing clips straight from a video server, or the creation of lower third graphics without storing it in the NRCS.</p>
<div class="theme-admonition theme-admonition-note admonition_WCGJ alert alert--secondary"><div class="admonitionHeading_GCBg"><span class="admonitionIcon_L39b"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>MOS reference</div><div class="admonitionContent_pbrs"><p><a href="https://mosprotocol.com/wp-content/MOS-Protocol-Documents/MOSProtocolVersion40/index.html#calibre_link-61" target="_blank" rel="noopener noreferrer">5.3 MOS Plug-in Communication messages</a></p><p>The link points at MOS documentations for MOS 4 (for the benefit of having the best documentation), but will be compatible with most older versions too.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_JmGV" id="bucket-items-workflow">Bucket items workflow<a href="#bucket-items-workflow" class="hash-link" aria-label="Direct link to Bucket items workflow" title="Direct link to Bucket items workflow">​</a></h2>
<p>MOS-plugins are managed through the Shelf-system. They are added as <code>external_frame</code> either as a Tab to a Rundown layout or as a Panel to a Dashboard layout.</p>
<p><img decoding="async" loading="lazy" alt="Video browser MOS Plugin in Shelf tab" src="/sofie-core/assets/images/shelf-bucket-items-eafd112bd0a53684c419a16a29114522.jpg" width="5110" height="1750" class="img_SS3x">
A video server browser plugin shown as a tab in the rundown layout shelf.</p>
<p>The user can create one or more Buckets. From the plugin they can drag-and-drop content into the buckets. The user can manage the buckets and their content by creating, renaming, re-arranging and deleting. More details available at the <a href="/sofie-core/docs/user-guide/concepts-and-architecture#buckets">Bucket concept description.</a></p>
<h2 class="anchor anchorWithStickyNavbar_JmGV" id="cross-origin-drag-and-drop">Cross-origin drag-and-drop<a href="#cross-origin-drag-and-drop" class="hash-link" aria-label="Direct link to Cross-origin drag-and-drop" title="Direct link to Cross-origin drag-and-drop">​</a></h2>
<div class="theme-admonition theme-admonition-note admonition_WCGJ alert alert--secondary"><div class="admonitionHeading_GCBg"><span class="admonitionIcon_L39b"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Bucket workflow without drag-and-drop</div><div class="admonitionContent_pbrs"><p>The plugin iFrame can send a <code>postMessage</code> call with an <code>ncsItem</code> payload to programatically create an ncsItem without the drag-and-drop interaction. This is a viable solution which avoids cross-origin drag-and-drop problems.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id="the-problem">The problem<a href="#the-problem" class="hash-link" aria-label="Direct link to The problem" title="Direct link to The problem">​</a></h3>
<p><strong>Web browsers prevent drops into a webpage if the drag started from a page hosted on another origin.</strong></p>
<p>This means that drag-and-drop must happen between pages from the same origin. This is relevant for MOS-plugins, as they are supposed to be displayed in iFrames. Specifically, this means that the plugin in the iFrame must be served from the same origin as the parent page (where the drop will happen).</p>
<p>There are no properties or options to bypass this from within HTML/Javascript. Bypassing is theoretically possible by overriding the browser&#x27;s security settings, but this is not recommended.</p>
<div class="theme-admonition theme-admonition-note admonition_WCGJ alert alert--secondary"><div class="admonitionHeading_GCBg"><span class="admonitionIcon_L39b"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Background</div><div class="admonitionContent_pbrs"><p>The background for the policy is discussed in this Chromium Issue from 2010: <a href="https://issues.chromium.org/issues/40083787" target="_blank" rel="noopener noreferrer">Security: do not allow on-page drag-and-drop from non-same-origin frames (or require an extra gesture)</a></p></div></div>
<div class="theme-admonition theme-admonition-note admonition_WCGJ alert alert--secondary"><div class="admonitionHeading_GCBg"><span class="admonitionIcon_L39b"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>What counts as different origins?</div><div class="admonitionContent_pbrs"><table><thead><tr><th>Sofie Server Domain</th><th>Plugin Domain</th><th>Cross-origin or Same-origin?</th></tr></thead><tbody><tr><td><code>https://mySofie.com:443</code></td><td><code>https://myPlugin.com:443</code></td><td>cross-origin: different domains</td></tr><tr><td></td><td><code>https://www.mySofie.com:443</code></td><td>cross-origin: different subdomains</td></tr><tr><td></td><td><code>https://myPlugin.mySofie.com:443</code></td><td> cross-origin: different subdomains</td></tr><tr><td></td><td><code>http://mySofie.com:443</code></td><td> cross-origin: different schemes</td></tr><tr><td></td><td><code>https://mySofie.com:80</code></td><td> cross-origin: different ports</td></tr><tr><td></td><td><code>https://mySofie.com:443/myPlugin</code></td><td>same-origin: domain, scheme and port match</td></tr><tr><td></td><td><code>https://mySofie.com/myPlugin</code></td><td>same-origin: domain, scheme and port match (https implies port 443)</td></tr></tbody></table></div></div>
<h4 class="anchor anchorWithStickyNavbar_JmGV" id="the-proxy-idea">The &quot;proxy idea&quot;<a href="#the-proxy-idea" class="hash-link" aria-label="Direct link to The &quot;proxy idea&quot;" title="Direct link to The &quot;proxy idea&quot;">​</a></h4>
<p>As you can tell from the table, you need to exactly match both the protocol, domain and port number. More importantly, different subdomains trigger the cross-origin policy.</p>
<p><em>The proxy idea</em> is to use rewrite-rules in a proxy server (e.g. NGINX) to serve the plugin from a path on the Sofie server&#x27;s domain. As this can&#x27;t be done as subdomains, that leaves the option of having a folder underneath the top level of the Sofie server&#x27;s domain.</p>
<p>An example of this would be to serve Sofie at <code>https://mysofie.com</code> and then host the plugin (directly or via a proxy) at <code>https://mysofie.com/myplugin</code>. Technically this will work, but this solution is fragile. All links within the plugin will have to be either absolute or truly relative links that take the URL structure into account. This is doable if the plugin is being developed with this in mind. But it leads to a fragile tight coupling between the plugin and the host application (Sofie) which can break with any inconsiderate udate in the future.</p>
<div class="theme-admonition theme-admonition-note admonition_WCGJ alert alert--secondary"><div class="admonitionHeading_GCBg"><span class="admonitionIcon_L39b"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Example of linking from a (potentially proxied) subfolder</div><div class="admonitionContent_pbrs"><p><strong>Case:</strong> <code>https://mysofie.com/myplugin/index.html</code> wants to acccess <code>https://mysofie.com/myplugin/static/images/logo.png</code>.</p><p>Normally the plugin would be developed and bundled to work standalone, resulting in a link relative to its own base path, giving <code>/static/images/logo.png</code> which here wrongly resolves to <code>https://mysofie.com/static/images/logo.png</code>.</p><p>The plugin would need to use either use the absolute <code>https://mysofie.com/myplugin/static/images/logo.png</code> or the relative <code>images/static/logo.png</code> or <code>./images/static/logo.png</code> or even <code>/myplugin/static/images/logo.png</code> to point to the right resource.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id="the-solution">The solution<a href="#the-solution" class="hash-link" aria-label="Direct link to The solution" title="Direct link to The solution">​</a></h3>
<p><strong>Sofie proposes a drag-and-drop/postMessage hybrid interface.</strong>
In this model the user interactions of drag-and-drop are targeting a dedicated Drop page served by the plugin-server (same-origin to the plugin). This can be transparently overlaid the real drop region and intercept drop events. The Bucket system has built-in support for this, configured as an additional property to the External frame panel setup in Shelf config.</p>
<p><img decoding="async" loading="lazy" alt="Configuration of External frame with dedicated drop-page" src="/sofie-core/assets/images/shelf-external_frame-config-bb2905abda2f31f1ed2b3a0f6a6c8e13.png" width="1494" height="1344" class="img_SS3x"></p>
<p>The true communication channel between the plugin and Sofie becomes a postMessage protocol where the plugin is managing all drag-and-drop events and converts them into the postMessage protocol. Sofie also handles edge cases such as timeouts, drag leaving the browser etc.</p>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id="sequence-diagram">Sequence diagram<a href="#sequence-diagram" class="hash-link" aria-label="Direct link to Sequence diagram" title="Direct link to Sequence diagram">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_JmGV" id="post-messages-from-the-plugin-drag-side">Post-messages from the Plugin (drag-side)<a href="#post-messages-from-the-plugin-drag-side" class="hash-link" aria-label="Direct link to Post-messages from the Plugin (drag-side)" title="Direct link to Post-messages from the Plugin (drag-side)">​</a></h4>
<table><thead><tr><th>Message</th><th>Payload</th><th>Description</th></tr></thead><tbody><tr><td>dragStart</td><td>-</td><td>Re-sends the DOM event dragStart as a postMessage of the same kind. <br> This is the signal to Sofie to toggle on the Drop-zone and indicate in the UI that a drag is happening.</td></tr><tr><td>dragEnd</td><td>-</td><td>Re-sends the DOM event dragEnd as a postMessage of the same kind. <br> This is the signal to Sofie to toggle off the Drop-zone and reset the UI.</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_JmGV" id="post-messages-from-the-plugin-drop-page">Post-messages from the Plugin Drop-page<a href="#post-messages-from-the-plugin-drop-page" class="hash-link" aria-label="Direct link to Post-messages from the Plugin Drop-page" title="Direct link to Post-messages from the Plugin Drop-page">​</a></h4>
<table><thead><tr><th>Message</th><th>Payload</th><th>Description</th></tr></thead><tbody><tr><td>dragEnter</td><td><code>{event: &#x27;dragEnter&#x27;, label: string}</code></td><td>To set the UI to reflect an object is being dragged into a specific bucket. <br> The label property can be used for showing a simple placeholder in the bucket.</td></tr><tr><td>dragLeave</td><td><code>{event: &#x27;dragLeave&#x27;}</code></td><td>To reset any UI.</td></tr><tr><td>drop</td><td><code>{event: &#x27;drop&#x27;}</code></td><td>To synchronously react to the drop in the UI.</td></tr><tr><td>data</td><td><code>{event: &#x27;data&#x27;, data: ncsItem}</code></td><td>To (a)synchronously receive the payload. <br> The expected format is an <code>ncsItem</code> MOS message (XML string)</td></tr><tr><td>error</td><td><code>{event: &#x27;error&#x27;, message}</code></td><td>To cancel the drag-operation and handle any errors.</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-note admonition_WCGJ alert alert--secondary"><div class="admonitionHeading_GCBg"><span class="admonitionIcon_L39b"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Please note</div><div class="admonitionContent_pbrs"><p>Please note how all interactions are happening over the postMessage interface.
No DOM-driven drag-n-drop events are relevant for Sofie, as they are solely handled between the plugin and its drop-page.</p></div></div>
<!-- -->
<h4 class="anchor anchorWithStickyNavbar_JmGV" id="minimal-example-sequence---happy-path">Minimal example sequence - happy path<a href="#minimal-example-sequence---happy-path" class="hash-link" aria-label="Direct link to Minimal example sequence - happy path" title="Direct link to Minimal example sequence - happy path">​</a></h4>
<p>Don&#x27;t worry, the sequence diagram shows a lot more detail than you need to think about. Consider this simple happy-path sequence as a representative interaction between the 3 actors (Plugin, Drop-page and Sofie):</p>
<ol>
<li>Plugin <code>dragStart</code></li>
<li>Drop-page <code>dragEnter</code></li>
<li>Plugin <code>dragEnd</code> and Drop-page <code>drop</code></li>
<li>Drop-page <code>data</code></li>
</ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/nrkno/sofie-core/edit/master/packages/documentation/docs/for-developers/mos-plugins.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_bHB7" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_ydrU"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/sofie-core/docs/for-developers/publications"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Publications</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_XG6w thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#bucket-items-workflow" class="table-of-contents__link toc-highlight">Bucket items workflow</a></li><li><a href="#cross-origin-drag-and-drop" class="table-of-contents__link toc-highlight">Cross-origin drag-and-drop</a><ul><li><a href="#the-problem" class="table-of-contents__link toc-highlight">The problem</a></li><li><a href="#the-solution" class="table-of-contents__link toc-highlight">The solution</a></li><li><a href="#sequence-diagram" class="table-of-contents__link toc-highlight">Sequence diagram</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" position="left" href="/sofie-core/docs/user-guide/intro">User Guide</a></li><li class="footer__item"><a class="footer__link-item" position="left" href="/sofie-core/docs/for-developers/intro">For Developers</a></li><li class="footer__item"><a class="footer__link-item" position="left" href="/sofie-core/releases">Releases</a></li></ul></div><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://join.slack.com/t/sofietv/shared_invite/zt-2bfz8l9lw-azLeDB55cvN2wvMgqL1alA" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sofie Slack Community<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" position="right" href="/sofie-core/docs/about-sofie">About Sofie</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ©2024 Norsk rikskringkasting AS and Contributors</div></div></div></footer></div>
</body>
</html>